## Метод внедрения сферического зародыша новой фазы

### Установка
```
git clone https://github.com/itpuroran/cavitation_seeding_sphere.git
```

### Применение

#### Создание двухфазных систем

В директории create содержатся файлы для создания сферических полостей в метастабильной жидкости.

Для запуска в папке create нужно разместить dump файлы метастабильной жидкости в папке dumpL, файлы должны иметь имена dump_liquid_0.txt, dump_liquid_1.txt и т.д.
"Шапка" файла должна иметь следующий вид:
```
ITEM: TIMESTEP
0
ITEM: NUMBER OF ATOMS
50000
ITEM: BOX BOUNDS pp pp pp
0.0000000000000000e+00 3.8058898021739161e+01
0.0000000000000000e+00 3.8058898021739161e+01
0.0000000000000000e+00 3.8058898021739161e+01
ITEM: ATOMS id type x y z vx vy vz 
```

В папке create содержатся следующие фалы:

* create_cavity_sphere_cut - шаблон стартового файла для вырезания сферической полости. В нем необходимо указать:
  * T0 - температура системы
  * в строке 23 - шаг по времени из входных dump файлов

* create_cavity_sphere_repulse - шаблон стартового файла для создания сферической полости путем введения отталкивающей частицы. В нем необходимо указать:
  * T0  - температура системы
  * r_0 - радиус маленькой предварительно вырезаемой полости
  * epsilon_2 - параметр epsilon для отталкивающей частицы
  * sigma_2 - начальный параметр sigma для отталкивающей частицы
  * sigma_2_max - максимальный параметр sigma для отталкивающей частицы
  * check_n_step - через сколько шагов проверять число частиц в полости
  * increase_sigma_step - через сколько шагов увеличивать параметр sigma
  * в строке 30 - шаг по времени из входных dump файлов

* p_gen_create.py - скрипт, который создает копии входных файлов. В нем нужно указать в строках 67-71:

  * R_start  - минимальный радиус полости
  * R_stop - максимальный радиус полости
  * delta_R - шаг изменения радиуса полости
  * ncopy - число копий системы при заданном радиусе
  * input_filename - шаблон входного файла ("create_cavity_sphere_repulse" или "create_cavity_sphere_cut")

* start - bash скрипт для запуска задач. В нем нужно указать:
  * nrad - число радиусов
  * ncopy - число копий системы

Порядок действий:

1. Поместить dump файлы жидкости в паку dumpL.
2. Задать все необходимые параметры в файлах create_cavity_sphere_repulse или create_cavity_sphere_cut, p_gen_create.py, start.
3. Запуск скрипта для создания входных файлов
   ```
   python p_gen_create.py
   ```
4. Поменять права доступа скрипта start. Запуск задач
   ```
   ./start
   ```
Результат (dump файлы двухфазных систем) будет записан в папку dumps_twophase. 

### Расчет размеров полости
	
* Перенести dumps_twophase в calc
* В файле cav_npt задать условия моделирования (давление, температура, ансамбль)
* В файле create_ini.py в строках 96 и 97 указать число радиусов и количество копий каждого, запустить командой
   ```
   python create_ini.py
   ```
* В файле skr_restart указать в строках 4 и 5 число радиусов и количество копий каждого, запуск: 
```
./skr_restart
```
* После завершения всех задач в папке dumps_end получите dump файлы с именами вида dump_end_0_8.txt, первое число номер радиуса, второе число - номер копии. В каждом файле два снимка: в нулевой момент времени и в последний (число шагов моделирования и частоту снимков можно задать в cav_npt).  
Если какие-то не досчитались до конца, можете просто удалить их файлы из папки dumps_end и заново запустить ./skr_restart. 

### Анализ изменения размеров полости
   
* Скомпилировать файл для расчета размера полости, просто запустив 
```
./make
```

* В файле params.txt указать:
 * still_sep      - расстояние, на котором частицы считаются ближайшими соседями
 * num_neighbors  - число соседей, начиная с которого частица считается принадлежащей жидкой фазе 
 * num_cells      - число ячеек решетки, которой делим систему, в одном измерении

* В файле start_calcV указать в строках 4 и 5 число радиусов и копий, запуск 
```
./start_calcV
```

* Скомпилировать программу для вычисления вероятности роста полости заданного размера 
```
./make_an
```
* Запуск анализа 
```
./analysis n m
```
здесь n - число радиусов, m - число копий. Результаты появятся в файлах Result_av и Result_gen




  












